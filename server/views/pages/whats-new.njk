{% extends "../partials/layout.njk" %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/accordion/macro.njk" import govukAccordion %}

{% set technicalUpdateItems = [] %}

{% for technicalUpdate in technicalUpdates %}
    {% set content %}

        {% for item in technicalUpdate.whatsNew %}
            {% if item | isArray (item) %}
                <ul class="govuk-list govuk-list--bullet govuk-!-margin-bottom-4">
                    {% for subItem in item %}
                        <li>{{ subItem }}</li>
                    {% endfor %}
                </ul>
            {%else%}
                <h3 class="govuk-heading-s govuk-!-margin-top-4">{{ item }}</h3>
            {% endif %}
        {% endfor%}
    {% endset %}

    {% set sectionHeadingHtml %}
        {{ technicalUpdate.heading }}
        {% if technicalUpdate.summary %}
            <span class="govuk-body govuk-!-display-block govuk-!-margin-top-1 govuk-!-font-weight-regular">{{ technicalUpdate.summary }}</span>
        {% endif %}
    {% endset %}

    {% set technicalUpdateItems = (technicalUpdateItems.push({
        heading: {
            html: sectionHeadingHtml
        },
            expanded: loop.first,
        content: {
            html: content
        }
    }), technicalUpdateItems) %}
{% endfor %}

{% block beforeContent %}
    {% if referrer %}
        {{ govukBackLink({
            text: "Back",
            href: referrer
        }) }}
    {% endif %}
{% endblock %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            <span class="govuk-caption-xl">Manage people on probation</span>
            <h1 class="govuk-heading-xl govuk-!-margin-bottom-6">Whatâ€™s new</h1>
        </div>
    </div>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            <h3 class="govuk-heading-s">Welcome to our service updates</h3>
            <p class="govuk-body">View highlights of what's new and what's improved for Manage people on probation.</p>
            <p class="govuk-body govuk-!-margin-bottom-5">
                If you have any feedback or questions on the service or any of these updates, email
                <a href="mailto:mpop-digital-team@justice.gov.uk" class="govuk-link">mpop-digital-team@justice.gov.uk</a>.
            </p>

            {{ govukAccordion({
                id: "accordion-default",
                headingLevel: 2,
                showAllSectionsText: 'Show all sections',
                hideAllSectionsText: "Hide all sections",
                items: technicalUpdateItems
            }) }}
        </div>
    </div>

{#    {% block javascripts %}#}
{#        <script nonce="{{ cspNonce }}">#}
{#          const latestUpdateHeading = technicalUpdateItems.length > 0 ? technicalUpdateItems[0].heading.text : '';#}
{#          localStorage.setItem("technicalUpdateReadVersion", latestUpdateHeading);#}
{#        </script>#}
{#    {% endblock %}#}

{% endblock %}