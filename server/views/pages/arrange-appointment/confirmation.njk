{% set phoneeNumber = case.mobileNumber %}

{% extends "../_form.njk" %}
{% set isRepeating = appointment.repeating == 'Yes' %}
{% set rearranging = appointment['rearrange-or-cancel'] %}
{% set buttonText = 'Arrange next appointment' %}
{% set notStandardForm = true %}
{% set appointmentDates = [appointment.date] %}
{% set phoneNumber = '' %}
{% if case.mobileNumber %}
  {% set phoneNumber = 'mobile' %}
{% endif %}
{% if not case.mobileNumber and case.telephoneNumber %}
  {% set phoneNumber = 'telephone' %}
{% endif %}
{% for appointmentDate in appointment.repeatingDates %}
  {% set appointmentDates = (appointmentDates.push(appointmentDate), appointmentDates) %}
{% endfor %}
{% set title = 'Appointment arranged' %}
{% set appointmentDatesHtml %}
{% for appointmentDate in appointmentDates %}
  {% if loop.index > 1 %}<br>{% endif %}
  <span data-qa="appointment-date">{{ appointmentDate | dayOfWeek }}
    {{ appointmentDate | dateWithYear }}
    from
    {{ appointment.start }}
    to
    {{ appointment.end }}</span>
{% endfor %}
{% endset %}

{% set panelHtml %}
<div class="govuk-!-font-size-27">
  <strong>{{ appointment.type.description }}</strong><br/>
  {{ appointmentDatesHtml | safe }}
</div>
{% endset %}

{% block beforeContent %}{% endblock %}
{% block primary %}
  {{ govukPanel({
  titleHtml: '<span data-qa="pageHeading">' + title + '</span>',
  html: panelHtml
}) }}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds" data-qa="what-happens-next">
      <h2 class="govuk-heading-m govuk-!-margin-top-6">What happens next</h2>
      <p class="govuk-body">
        You need to send
        {{case.name.forename}}
        the appointment details.
      </p>
      {% if phoneNumber %}
        <p class="govuk-body" data-qa="popContactNumber">
          {{case.name.forename}}â€™s phone number is
        <span data-qa="{{ phoneNumber }}">
            {% if phoneNumber == 'mobile' %}{{ case.mobileNumber + "." }}
            {% else %}{{ case.telephoneNumber + "." }}
            {% endif %}</span></p>
      {% endif %}
      <h2 class="govuk-heading-m govuk-!-margin-top-6">Arrange another appointment</h2>
      <p class="govuk-body">
        Use the saved details of this appointment to create a new one. You can amend any of the details.</p>

    </div>
  </div>
<form method="post" autocomplete="off" action="{{ paths.current }}">
  <div class="govuk-button-group">
    {{ govukButton({
      html: buttonText,
      attributes: {
        'data-qa': 'submit-btn'
      }
    }) }}
    <a class="govuk-link" href="/case/{{ crn }}/appointments" data-qa="finishLink">
      Finish and return to appointments
    </a>
  </div>
  <input type="hidden" name="_csrf" value="{{ csrfToken }}">
</form>
{% endblock %}